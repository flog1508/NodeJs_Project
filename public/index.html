<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üéØ Habit Tracker - Interface de Test API</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }
    
    .container {
      max-width: 1400px;
      margin: 0 auto;
    }
    
    h1 {
      color: white;
      text-align: center;
      margin-bottom: 30px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
      font-size: 2.5em;
    }
    
    .tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    
    .tab-btn {
      padding: 12px 24px;
      background: rgba(255,255,255,0.2);
      color: white;
      border: 2px solid white;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.3s;
    }
    
    .tab-btn:hover {
      background: rgba(255,255,255,0.3);
      transform: translateY(-2px);
    }
    
    .tab-btn.active {
      background: white;
      color: #667eea;
    }
    
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
    }
    
    .section {
      background: white;
      padding: 25px;
      margin: 15px 0;
      border-radius: 10px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    
    .section h2 {
      color: #667eea;
      margin-bottom: 15px;
      border-bottom: 2px solid #667eea;
      padding-bottom: 10px;
      font-size: 1.3em;
    }
    
    .input-row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 15px;
    }
    
    input, select, textarea {
      padding: 10px;
      font-size: 14px;
      border-radius: 5px;
      border: 1px solid #ddd;
      flex: 1;
      min-width: 200px;
    }
    
    textarea {
      min-height: 80px;
      resize: vertical;
    }
    
    button {
      padding: 10px 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.2s;
      font-size: 14px;
    }
    
    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
    
    button:active {
      transform: translateY(0);
    }
    
    .result {
      background-color: #f9f9f9;
      border: 1px solid #ddd;
      padding: 15px;
      margin-top: 15px;
      border-radius: 5px;
      max-height: 400px;
      overflow-y: auto;
      white-space: pre-wrap;
      word-wrap: break-word;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      line-height: 1.5;
    }
    
    .result:empty {
      display: none;
    }
    
    .badge {
      display: inline-block;
      padding: 4px 8px;
      background: #667eea;
      color: white;
      border-radius: 4px;
      font-size: 11px;
      font-weight: bold;
      margin-left: 10px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üéØ Habit Tracker - Interface de Test API</h1>
    
    <div class="tabs">
      <button class="tab-btn active" onclick="switchTab('users')">üë§ USERS (√âtudiant 1)</button>
      <button class="tab-btn" onclick="switchTab('habits')">‚úÖ HABITS (√âtudiant 2)</button>
      <button class="tab-btn" onclick="switchTab('logs')">üìù LOGS (√âtudiant 3)</button>
      <button class="tab-btn" onclick="switchTab('stats')">üìä STATS (√âtudiant 4)</button>
    </div>

    <!-- USERS -->
    <div id="users" class="tab-content active">
      <div class="section">
        <h2>1Ô∏è‚É£ Cr√©er un utilisateur <span class="badge">POST</span></h2>
        <div class="input-row">
          <input type="text" id="user_username" placeholder="Username" value="alice">
          <input type="email" id="user_email" placeholder="Email" value="alice@example.com">
          <input type="password" id="user_password" placeholder="Password" value="password123">
          <button onclick="createUser()">‚ú® Cr√©er</button>
        </div>
        <div id="result_createUser" class="result"></div>
      </div>

      <div class="section">
        <h2>2Ô∏è‚É£ Rechercher des utilisateurs <span class="badge">GET</span></h2>
        <div class="input-row">
          <input type="text" id="user_search" placeholder="Rechercher">
          <input type="number" id="user_page" placeholder="Page" value="1">
          <input type="number" id="user_limit" placeholder="Limite" value="10">
          <button onclick="searchUsers()">üîç Rechercher</button>
        </div>
        <div id="result_searchUsers" class="result"></div>
      </div>

      <div class="section">
        <h2>3Ô∏è‚É£ Stats utilisateur (Agr√©gation) <span class="badge">GET</span></h2>
        <div class="input-row">
          <input type="text" id="user_stats_id" placeholder="ID utilisateur">
          <button onclick="getUserStats()">üìä Voir Stats</button>
        </div>
        <div id="result_getUserStats" class="result"></div>
      </div>

      <div class="section">
        <h2>4Ô∏è‚É£ Modifier un utilisateur <span class="badge">PUT</span></h2>
        <div class="input-row">
          <input type="text" id="user_update_id" placeholder="ID utilisateur">
          <input type="text" id="user_update_username" placeholder="Nouveau username">
          <input type="email" id="user_update_email" placeholder="Nouvel email">
          <button onclick="updateUser()">‚úèÔ∏è Modifier</button>
        </div>
        <div id="result_updateUser" class="result"></div>
      </div>

      <div class="section">
        <h2>5Ô∏è‚É£ Importer utilisateurs <span class="badge">GET</span></h2>
        <div class="input-row">
          <button onclick="importUsers()">üì• Importer JSON</button>
        </div>
        <div id="result_importUsers" class="result"></div>
      </div>

      <div class="section">
        <h2>6Ô∏è‚É£ Stats globales <span class="badge">GET</span></h2>
        <div class="input-row">
          <button onclick="getGlobalStats()">üìà Stats Globales</button>
        </div>
        <div id="result_getGlobalStats" class="result"></div>
      </div>

      <div class="section">
        <h2>7Ô∏è‚É£ Exporter stats <span class="badge">GET</span></h2>
        <div class="input-row">
          <button onclick="exportUserStats()">üì§ Exporter JSON</button>
        </div>
        <div id="result_exportUserStats" class="result"></div>
      </div>
    </div>

    <!--  HABITS -->
    <div id="habits" class="tab-content">
      <div class="section">
        <h2>1Ô∏è‚É£ Cr√©er une habitude <span class="badge">POST</span></h2>
        <div class="input-row">
          <input type="text" id="habit_user_id" placeholder="User ID">
          <input type="text" id="habit_title" placeholder="Titre" value="Faire du sport">
          <select id="habit_category">
            <option value="health">Sant√©</option>
            <option value="work">Travail</option>
            <option value="personal">Personnel</option>
            <option value="learning">Apprentissage</option>
            <option value="social">Social</option>
          </select>
          <input type="text" id="habit_description" placeholder="Description">
          <select id="habit_frequency">
            <option value="daily">Quotidien</option>
            <option value="weekly">Hebdomadaire</option>
            <option value="monthly">Mensuel</option>
          </select>
          <button onclick="createHabit()">‚ú® Cr√©er</button>
        </div>
        <div id="result_createHabit" class="result"></div>
      </div>

      <div class="section">
        <h2>2Ô∏è‚É£ Rechercher habitudes <span class="badge">GET</span></h2>
        <div class="input-row">
          <input type="text" id="habit_filter_user" placeholder="User ID">
          <select id="habit_filter_category">
            <option value="">Toutes</option>
            <option value="health">Sant√©</option>
            <option value="work">Travail</option>
          </select>
          <input type="text" id="habit_filter_search" placeholder="Recherche">
          <button onclick="searchHabits()">üîç Rechercher</button>
        </div>
        <div id="result_searchHabits" class="result"></div>
      </div>

      <div class="section">
        <h2>3Ô∏è‚É£ Stats par cat√©gorie <span class="badge">GET</span></h2>
        <div class="input-row">
          <button onclick="getHabitStatsByCategory()">üìä Stats</button>
        </div>
        <div id="result_getHabitStatsByCategory" class="result"></div>
      </div>
    </div>

    <!--  LOGS -->
    <div id="logs" class="tab-content">
      <div class="section">
        <h2>1Ô∏è‚É£ Cr√©er un log <span class="badge">POST</span></h2>
        <div class="input-row">
          <input type="text" id="log_habit_id" placeholder="ID Habitude">
          <input type="text" id="log_user_id" placeholder="ID User">
          <input type="date" id="log_date">
          <select id="log_completed">
            <option value="true">‚úÖ Compl√©t√©</option>
            <option value="false">‚ùå Rat√©</option>
          </select>
          <button onclick="createLog()">‚ú® Cr√©er</button>
        </div>
        <div id="result_createLog" class="result"></div>
      </div>

      <div class="section">
        <h2>2Ô∏è‚É£ Historique <span class="badge">GET</span></h2>
        <div class="input-row">
          <input type="text" id="log_filter_habit" placeholder="ID Habitude">
          <input type="text" id="log_filter_user" placeholder="ID User">
          <button onclick="getLogHistory()">üîç Voir</button>
        </div>
        <div id="result_getLogHistory" class="result"></div>
      </div>

      <div class="section">
        <h2>3Ô∏è‚É£ Streaks <span class="badge">GET</span></h2>
        <div class="input-row">
          <button onclick="getStreaks()">üî• Streaks</button>
        </div>
        <div id="result_getStreaks" class="result"></div>
      </div>

      <div class="section">
        <h2>4Ô∏è‚É£ Import logs <span class="badge">POST</span></h2>
        <div class="input-row">
          <button onclick="importLogs()">üì• Importer</button>
        </div>
        <div id="result_importLogs" class="result"></div>
      </div>

      <div class="section">
        <h2>5Ô∏è‚É£ Export logs <span class="badge">GET</span></h2>
        <div class="input-row">
          <input type="text" id="log_export_user" placeholder="User ID">
          <button onclick="exportLogs()">üì§ Exporter</button>
        </div>
        <div id="result_exportLogs" class="result"></div>
      </div>
    </div>

    <!--  STATS -->
    <div id="stats" class="tab-content">
      <div class="section">
        <h2>1Ô∏è‚É£ Export stats <span class="badge">POST</span></h2>
        <div class="input-row">
          <input type="text" id="stats_export_user" placeholder="User ID">
          <select id="stats_export_period">
            <option value="weekly">Hebdo</option>
            <option value="monthly">Mensuel</option>
            <option value="yearly">Annuel</option>
          </select>
          <button onclick="exportStatistics()">üì§ Exporter</button>
        </div>
        <div id="result_exportStatistics" class="result"></div>
      </div>

      <div class="section">
        <h2>2Ô∏è‚É£ Dashboard <span class="badge">GET</span></h2>
        <div class="input-row">
          <input type="text" id="stats_dashboard_user" placeholder="User ID">
          <select id="stats_dashboard_period">
            <option value="monthly">Mensuel</option>
          </select>
          <button onclick="getDashboard()">üìä Dashboard</button>
        </div>
        <div id="result_getDashboard" class="result"></div>
      </div>

      <div class="section">
        <h2>3Ô∏è‚É£ Agr√©gation Users‚ÜíHabits <span class="badge">GET</span></h2>
        <div class="input-row">
          <input type="number" id="stats_aggregation_limit" placeholder="Limite" value="10">
          <button onclick="getUsersWithHabits()">üîó Voir</button>
        </div>
        <div id="result_getUsersWithHabits" class="result"></div>
      </div>

      <div class="section">
        <h2>4Ô∏è‚É£ Top habitudes <span class="badge">GET</span></h2>
        <div class="input-row">
          <input type="number" id="stats_top_limit" placeholder="Limite" value="5">
          <button onclick="getStatsTopHabits()">üèÜ Top</button>
        </div>
        <div id="result_getStatsTopHabits" class="result"></div>
      </div>

      <div class="section">
        <h2>5Ô∏è‚É£ Vue d'ensemble <span class="badge">GET</span></h2>
        <div class="input-row">
          <button onclick="getOverview()">üåç Overview</button>
        </div>
        <div id="result_getOverview" class="result"></div>
      </div>

      <div class="section">
        <h2>6Ô∏è‚É£ Stats par cat√©gorie <span class="badge">GET</span></h2>
        <div class="input-row">
          <button onclick="getStatsByCategory()">üìä Cat√©gories</button>
        </div>
        <div id="result_getStatsByCategory" class="result"></div>
      </div>
    </div>
  </div>

  <script>
    const API = 'http://localhost:5000/api';

    function switchTab(tabName) {
      document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
      document.getElementById(tabName).classList.add('active');
      event.target.classList.add('active');
    }

    function show(id, data) {
      document.getElementById(id).textContent = JSON.stringify(data, null, 2);
    }

    //  USERS 
    async function createUser() {
      try {
        const res = await fetch(`${API}/users/register`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            username: document.getElementById('user_username').value,
            email: document.getElementById('user_email').value,
            password: document.getElementById('user_password').value
          })
        });
        show('result_createUser', await res.json());
      } catch (e) {
        show('result_createUser', { error: e.message });
      }
    }

    async function searchUsers() {
      try {
        const params = new URLSearchParams({
          search: document.getElementById('user_search').value,
          page: document.getElementById('user_page').value,
          limit: document.getElementById('user_limit').value
        });
        const res = await fetch(`${API}/users/search?${params}`);
        show('result_searchUsers', await res.json());
      } catch (e) {
        show('result_searchUsers', { error: e.message });
      }
    }

    async function getUserStats() {
      try {
        const id = document.getElementById('user_stats_id').value;
        if (!id) return alert('ID requis');
        const res = await fetch(`${API}/users/${id}/stats`);
        show('result_getUserStats', await res.json());
      } catch (e) {
        show('result_getUserStats', { error: e.message });
      }
    }

    async function updateUser() {
      try {
        const id = document.getElementById('user_update_id').value;
        if (!id) return alert('ID requis');
        const res = await fetch(`${API}/users/${id}`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            username: document.getElementById('user_update_username').value,
            email: document.getElementById('user_update_email').value
          })
        });
        show('result_updateUser', await res.json());
      } catch (e) {
        show('result_updateUser', { error: e.message });
      }
    }

    async function importUsers() {
      try {
        const res = await fetch(`${API}/users/import`);
        show('result_importUsers', await res.json());
      } catch (e) {
        show('result_importUsers', { error: e.message });
      }
    }

    async function getGlobalStats() {
      try {
        const res = await fetch(`${API}/users/stats/global`);
        show('result_getGlobalStats', await res.json());
      } catch (e) {
        show('result_getGlobalStats', { error: e.message });
      }
    }

    async function exportUserStats() {
      try {
        const res = await fetch(`${API}/users/stats/export`);
        show('result_exportUserStats', await res.json());
      } catch (e) {
        show('result_exportUserStats', { error: e.message });
      }
    }

    //  HABITS 
    async function createHabit() {
      try {
        const res = await fetch(`${API}/habits`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            user: document.getElementById('habit_user_id').value,
            title: document.getElementById('habit_title').value,
            category: document.getElementById('habit_category').value,
            description: document.getElementById('habit_description').value,
            frequency: document.getElementById('habit_frequency').value
          })
        });
        show('result_createHabit', await res.json());
      } catch (e) {
        show('result_createHabit', { error: e.message });
      }
    }

    async function searchHabits() {
      try {
        const params = new URLSearchParams({
          user: document.getElementById('habit_filter_user').value,
          category: document.getElementById('habit_filter_category').value,
          search: document.getElementById('habit_filter_search').value
        });
        
        const res = await fetch(`${API}/habits/search?${params}`);
        show('result_searchHabits', await res.json());
      } catch (e) {
        show('result_searchHabits', { error: e.message });
      }
    }

    async function getHabitStatsByCategory() {
      try {
        ///stats/categories 
        const res = await fetch(`${API}/habits/stats/categories`);
        show('result_getHabitStatsByCategory', await res.json());
      } catch (e) {
        show('result_getHabitStatsByCategory', { error: e.message });
      }
    }

    // LOGS 
    async function createLog() {
      try {
        const res = await fetch(`${API}/habitlogs`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            habit: document.getElementById('log_habit_id').value,
            user: document.getElementById('log_user_id').value,
            date: document.getElementById('log_date').value,
            completed: document.getElementById('log_completed').value === 'true'
          })
        });
        show('result_createLog', await res.json());
      } catch (e) {
        show('result_createLog', { error: e.message });
      }
    }

    async function getLogHistory() {
      try {
        const params = new URLSearchParams({
          habit: document.getElementById('log_filter_habit').value,
          user: document.getElementById('log_filter_user').value
        });
        const res = await fetch(`${API}/habitlogs/history?${params}`);
        show('result_getLogHistory', await res.json());
      } catch (e) {
        show('result_getLogHistory', { error: e.message });
      }
    }

    async function getStreaks() {
      try {
        const res = await fetch(`${API}/habitlogs/streaks`);
        show('result_getStreaks', await res.json());
      } catch (e) {
        show('result_getStreaks', { error: e.message });
      }
    }

    async function importLogs() {
      try {
        const res = await fetch(`${API}/habitlogs/import`, { method: 'POST' });
        show('result_importLogs', await res.json());
      } catch (e) {
        show('result_importLogs', { error: e.message });
      }
    }

    async function exportLogs() {
      try {
        const params = new URLSearchParams({
          userId: document.getElementById('log_export_user').value
        });
        const res = await fetch(`${API}/habitlogs/export?${params}`);
        show('result_exportLogs', await res.json());
      } catch (e) {
        show('result_exportLogs', { error: e.message });
      }
    }

    // ========== STATS ==========
    async function exportStatistics() {
      try {
        const res = await fetch(`${API}/stats/export`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            userId: document.getElementById('stats_export_user').value,
            period: document.getElementById('stats_export_period').value
          })
        });
        show('result_exportStatistics', await res.json());
      } catch (e) {
        show('result_exportStatistics', { error: e.message });
      }
    }

    async function getDashboard() {
      try {
        const params = new URLSearchParams({
          userId: document.getElementById('stats_dashboard_user').value,
          period: document.getElementById('stats_dashboard_period').value
        });
        const res = await fetch(`${API}/stats/dashboard?${params}`);
        show('result_getDashboard', await res.json());
      } catch (e) {
        show('result_getDashboard', { error: e.message });
      }
    }

    async function getUsersWithHabits() {
      try {
        const limit = document.getElementById('stats_aggregation_limit').value;
        const res = await fetch(`${API}/stats/aggregation?limit=${limit}`);
        show('result_getUsersWithHabits', await res.json());
      } catch (e) {
        show('result_getUsersWithHabits', { error: e.message });
      }
    }

    async function getStatsTopHabits() {
      try {
        const limit = document.getElementById('stats_top_limit').value;
        const res = await fetch(`${API}/stats/top-habits?limit=${limit}`);
        show('result_getStatsTopHabits', await res.json());
      } catch (e) {
        show('result_getStatsTopHabits', { error: e.message });
      }
    }

    async function getOverview() {
      try {
        const res = await fetch(`${API}/stats/overview`);
        show('result_getOverview', await res.json());
      } catch (e) {
        show('result_getOverview', { error: e.message });
      }
    }

    async function getStatsByCategory() {
      try {
        const res = await fetch(`${API}/stats/categories`);
        show('result_getStatsByCategory', await res.json());
      } catch (e) {
        show('result_getStatsByCategory', { error: e.message });
      }
    }

    // Auto-set today's date
    document.getElementById('log_date').valueAsDate = new Date();
  </script>
</body>
</html>