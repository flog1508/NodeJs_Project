<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üéØ Habit Tracker - Interface de Test API</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }
    
    .container {
      max-width: 1400px;
      margin: 0 auto;
    }
    
    h1 {
      color: white;
      text-align: center;
      margin-bottom: 30px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
      font-size: 2.5em;
    }
    
    .tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    
    .tab-btn {
      padding: 12px 24px;
      background: rgba(255,255,255,0.2);
      color: white;
      border: 2px solid white;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.3s;
      font-size: 14px;
    }
    
    .tab-btn:hover {
      background: rgba(255,255,255,0.3);
      transform: translateY(-2px);
    }
    
    .tab-btn.active {
      background: white;
      color: #667eea;
    }
    
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
    }
    
    .section {
      background: white;
      padding: 25px;
      margin: 15px 0;
      border-radius: 10px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    
    .section h2 {
      color: #667eea;
      margin-bottom: 15px;
      border-bottom: 2px solid #667eea;
      padding-bottom: 10px;
      font-size: 1.3em;
    }
    
    .input-row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 15px;
    }
    
    input, select, textarea {
      padding: 10px;
      font-size: 14px;
      border-radius: 5px;
      border: 1px solid #ddd;
      flex: 1;
      min-width: 200px;
    }
    
    input[type="checkbox"] {
      flex: 0;
      min-width: auto;
      width: 20px;
      height: 20px;
    }
    
    textarea {
      min-height: 80px;
      resize: vertical;
    }
    
    button {
      padding: 10px 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.2s;
      font-size: 14px;
    }
    
    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
    
    button:active {
      transform: translateY(0);
    }
    
    button.delete {
      background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
    }
    
    .result {
      background-color: #f9f9f9;
      border: 1px solid #ddd;
      padding: 15px;
      margin-top: 15px;
      border-radius: 5px;
      max-height: 400px;
      overflow-y: auto;
      white-space: pre-wrap;
      word-wrap: break-word;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      line-height: 1.5;
    }
    
    .result:empty {
      display: none;
    }
    
    .badge {
      display: inline-block;
      padding: 4px 8px;
      background: #667eea;
      color: white;
      border-radius: 4px;
      font-size: 11px;
      font-weight: bold;
      margin-left: 10px;
    }
    
    .badge.delete {
      background: #ef4444;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üéØ Habit Tracker - Interface de Test API</h1>
    
    <div class="tabs">
      <button class="tab-btn active" onclick="switchTab('users')">üë§ USERS (√âtudiant 1)</button>
      <button class="tab-btn" onclick="switchTab('habits')">‚úÖ HABITS (√âtudiant 2)</button>
      <button class="tab-btn" onclick="switchTab('logs')">üìù LOGS (√âtudiant 3)</button>
      <button class="tab-btn" onclick="switchTab('stats')">üìä STATS (√âtudiant 4)</button>
    </div>

    <!-- ==================== USERS ==================== -->
    <div id="users" class="tab-content active">
      <div class="section">
        <h2>1Ô∏è‚É£ Cr√©er un utilisateur <span class="badge">POST</span></h2>
        <div class="input-row">
          <input type="text" id="username" placeholder="Username" value="TestUser">
          <input type="email" id="email" placeholder="Email" value="test@example.com">
          <input type="password" id="password" placeholder="Password" value="secret123">
          <button onclick="createUser()">‚ú® Cr√©er</button>
        </div>
        <div id="createResult" class="result"></div>
      </div>

      <div class="section">
        <h2>2Ô∏è‚É£ Rechercher des utilisateurs <span class="badge">GET</span></h2>
        <div class="input-row">
          <input type="text" id="searchQuery" placeholder="Rechercher">
          <input type="number" id="limit" placeholder="Limite" value="5">
          <button onclick="searchUsers()">üîç Rechercher</button>
        </div>
        <div id="searchResult" class="result"></div>
      </div>

      <div class="section">
        <h2>3Ô∏è‚É£ Stats utilisateur (Agr√©gation) <span class="badge">GET</span></h2>
        <div class="input-row">
          <input type="text" id="statsUserId" placeholder="ID utilisateur">
          <button onclick="getUserStats()">üìä Voir Stats</button>
        </div>
        <div id="statsResult" class="result"></div>
      </div>

      <div class="section">
        <h2>4Ô∏è‚É£ Modifier un utilisateur <span class="badge">PUT</span></h2>
        <div class="input-row">
          <input type="text" id="userId" placeholder="ID utilisateur">
          <input type="text" id="newUsername" placeholder="Nouveau username">
          <button onclick="updateUser()">‚úèÔ∏è Modifier</button>
        </div>
        <div id="updateResult" class="result"></div>
      </div>

      <div class="section">
        <h2>5Ô∏è‚É£ Importer utilisateurs <span class="badge">GET</span></h2>
        <div class="input-row">
          <button onclick="importUsers()">üì• Importer JSON</button>
        </div>
        <div id="importResult" class="result"></div>
      </div>

      <div class="section">
        <h2>6Ô∏è‚É£ Stats globales <span class="badge">GET</span></h2>
        <div class="input-row">
          <button onclick="getGlobalStats()">üìà Stats Globales</button>
        </div>
        <div id="globalStatsResult" class="result"></div>
      </div>

      <div class="section">
        <h2>7Ô∏è‚É£ Exporter stats <span class="badge">GET</span></h2>
        <div class="input-row">
          <button onclick="exportUsers()">üì§ Exporter JSON</button>
        </div>
        <div id="exportResult" class="result"></div>
      </div>

      <div class="section">
        <h2>8Ô∏è‚É£ Supprimer un utilisateur <span class="badge delete">DELETE</span></h2>
        <div class="input-row">
          <input type="text" id="deleteUserId" placeholder="ID utilisateur">
          <button class="delete" onclick="deleteUser()">üóëÔ∏è Supprimer</button>
        </div>
        <div id="deleteUserResult" class="result"></div>
      </div>
    </div>

    <!-- ==================== HABITS ==================== -->
    <div id="habits" class="tab-content">
      <div class="section">
        <h2>1Ô∏è‚É£ Cr√©er une habitude <span class="badge">POST</span></h2>
        <div class="input-row">
          <input type="text" id="habitUserId" placeholder="User ID">
          <input type="text" id="habitTitle" placeholder="Titre" value="Faire du sport">
          <input type="text" id="habitCategory" placeholder="Cat√©gorie" value="health">
          <input type="text" id="habitDesc" placeholder="Description">
          <input type="text" id="habitFreq" placeholder="Fr√©quence" value="daily">
          <button onclick="createHabit()">‚ú® Cr√©er</button>
        </div>
        <div id="habitCreateResult" class="result"></div>
      </div>

      <div class="section">
        <h2>2Ô∏è‚É£ Rechercher habitudes <span class="badge">GET</span></h2>
        <div class="input-row">
          <input type="text" id="filterUserId" placeholder="User ID">
          <input type="text" id="filterCategory" placeholder="Cat√©gorie">
          <input type="text" id="filterSearch" placeholder="Recherche">
          <input type="number" id="filterLimit" placeholder="Limite" value="5">
          <button onclick="filterHabits()">üîç Rechercher</button>
        </div>
        <div id="habitFilterResult" class="result"></div>
      </div>

      <div class="section">
        <h2>3Ô∏è‚É£ Stats par cat√©gorie <span class="badge">GET</span></h2>
        <div class="input-row">
          <button onclick="getHabitStats()">üìä Stats</button>
        </div>
        <div id="habitStatsResult" class="result"></div>
      </div>

      <div class="section">
        <h2>4Ô∏è‚É£ Habitudes populaires <span class="badge">GET</span></h2>
        <div class="input-row">
          <input type="number" id="popularLimit" placeholder="Limite" value="5">
          <button onclick="getPopularHabits()">üèÜ Top</button>
        </div>
        <div id="popularHabitsResult" class="result"></div>
      </div>

      <div class="section">
        <h2>5Ô∏è‚É£ Supprimer une habitude <span class="badge delete">DELETE</span></h2>
        <div class="input-row">
          <input type="text" id="deleteHabitId" placeholder="ID habitude">
          <button class="delete" onclick="deleteHabit()">üóëÔ∏è Supprimer</button>
        </div>
        <div id="deleteHabitResult" class="result"></div>
      </div>
    </div>

    <!-- ==================== LOGS ==================== -->
    <div id="logs" class="tab-content">
      <div class="section">
        <h2>1Ô∏è‚É£ Cr√©er un log <span class="badge">POST</span></h2>
        <div class="input-row">
          <input type="text" id="logHabitId" placeholder="Habit ID">
          <input type="text" id="logUserId" placeholder="User ID">
          <label style="display: flex; align-items: center; gap: 5px;">
            <input type="checkbox" id="logCompleted" checked>
            <span>Compl√©t√©</span>
          </label>
          <input type="text" id="logNotes" placeholder="Notes">
          <button onclick="createLog()">‚ú® Cr√©er</button>
        </div>
        <div id="createLogResult" class="result"></div>
      </div>

      <div class="section">
        <h2>2Ô∏è‚É£ Historique <span class="badge">GET</span></h2>
        <div class="input-row">
          <input type="text" id="historyUserId" placeholder="User ID">
          <input type="text" id="historyHabitId" placeholder="Habit ID">
          <input type="number" id="historyLimit" placeholder="Limite" value="10">
          <button onclick="getHistory()">üîç Voir</button>
        </div>
        <div id="historyResult" class="result"></div>
      </div>

      <div class="section">
        <h2>3Ô∏è‚É£ Streaks <span class="badge">GET</span></h2>
        <div class="input-row">
          <button onclick="getStreaks()">üî• Streaks</button>
        </div>
        <div id="streaksResult" class="result"></div>
      </div>

      <div class="section">
        <h2>4Ô∏è‚É£ Import logs <span class="badge">POST</span></h2>
        <div class="input-row">
          <button onclick="importLogs()">üì• Importer</button>
        </div>
        <div id="importLogsResult" class="result"></div>
      </div>

      <div class="section">
        <h2>5Ô∏è‚É£ Export logs <span class="badge">GET</span></h2>
        <div class="input-row">
          <input type="text" id="exportLogsUserId" placeholder="User ID">
          <button onclick="exportLogs()">üì§ Exporter</button>
        </div>
        <div id="exportLogsResult" class="result"></div>
      </div>

      <div class="section">
        <h2>6Ô∏è‚É£ Supprimer un log <span class="badge delete">DELETE</span></h2>
        <div class="input-row">
          <input type="text" id="deleteLogId" placeholder="ID log">
          <button class="delete" onclick="deleteLog()">üóëÔ∏è Supprimer</button>
        </div>
        <div id="deleteLogResult" class="result"></div>
      </div>
    </div>

    <!-- ==================== STATS ==================== -->
    <div id="stats" class="tab-content">
      <div class="section">
        <h2>1Ô∏è‚É£ Export stats <span class="badge">POST</span></h2>
        <div class="input-row">
          <input type="text" id="stats_export_user" placeholder="User ID">
          <select id="stats_export_period">
            <option value="weekly">Hebdo</option>
            <option value="monthly">Mensuel</option>
            <option value="yearly">Annuel</option>
          </select>
          <button onclick="exportStatistics()">üì§ Exporter</button>
        </div>
        <div id="result_exportStatistics" class="result"></div>
      </div>

      <div class="section">
        <h2>2Ô∏è‚É£ Dashboard <span class="badge">GET</span></h2>
        <div class="input-row">
          <input type="text" id="stats_dashboard_user" placeholder="User ID">
          <select id="stats_dashboard_period">
            <option value="monthly">Mensuel</option>
          </select>
          <button onclick="getDashboard()">üìä Dashboard</button>
        </div>
        <div id="result_getDashboard" class="result"></div>
      </div>

      <div class="section">
        <h2>3Ô∏è‚É£ Agr√©gation Users‚ÜíHabits <span class="badge">GET</span></h2>
        <div class="input-row">
          <input type="number" id="stats_aggregation_limit" placeholder="Limite" value="10">
          <button onclick="getUsersWithHabits()">üîó Voir</button>
        </div>
        <div id="result_getUsersWithHabits" class="result"></div>
      </div>

      <div class="section">
        <h2>4Ô∏è‚É£ Top habitudes <span class="badge">GET</span></h2>
        <div class="input-row">
          <input type="number" id="stats_top_limit" placeholder="Limite" value="5">
          <button onclick="getStatsTopHabits()">üèÜ Top</button>
        </div>
        <div id="result_getStatsTopHabits" class="result"></div>
      </div>

      <div class="section">
        <h2>5Ô∏è‚É£ Vue d'ensemble <span class="badge">GET</span></h2>
        <div class="input-row">
          <button onclick="getOverview()">üåç Overview</button>
        </div>
        <div id="result_getOverview" class="result"></div>
      </div>

      <div class="section">
        <h2>6Ô∏è‚É£ Stats par cat√©gorie <span class="badge">GET</span></h2>
        <div class="input-row">
          <button onclick="getStatsByCategory()">üìä Cat√©gories</button>
        </div>
        <div id="result_getStatsByCategory" class="result"></div>
      </div>

      <div class="section">
        <h2>7Ô∏è‚É£ Importer stats <span class="badge">POST</span></h2>
        <div class="input-row">
          <button onclick="importStats()">üì• Importer JSON</button>
        </div>
        <div id="result_importStats" class="result"></div>
      </div>
    </div>
  </div>

  <script>
    const API_URL = "http://localhost:5000/api";

    function switchTab(tabName) {
      document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
      document.getElementById(tabName).classList.add('active');
      event.target.classList.add('active');
    }

    function show(id, data) {
      document.getElementById(id).textContent = JSON.stringify(data, null, 2);
    }

    // ==================== USERS ====================
    async function createUser() {
      const username = document.getElementById("username").value;
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;
      try {
        const res = await fetch(`${API_URL}/users/register`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ username, email, password })
        });
        show("createResult", await res.json());
      } catch (e) {
        show("createResult", { error: e.message });
      }
    }

    async function searchUsers() {
      const search = document.getElementById("searchQuery").value;
      const limit = document.getElementById("limit").value;
      try {
        const res = await fetch(`${API_URL}/users/search?search=${search}&limit=${limit}`);
        show("searchResult", await res.json());
      } catch (e) {
        show("searchResult", { error: e.message });
      }
    }

    async function getUserStats() {
      const userId = document.getElementById("statsUserId").value;
      if (!userId) return alert("ID requis");
      try {
        const res = await fetch(`${API_URL}/users/${userId}/stats`);
        show("statsResult", await res.json());
      } catch (e) {
        show("statsResult", { error: e.message });
      }
    }

    async function updateUser() {
      const userId = document.getElementById("userId").value;
      const newUsername = document.getElementById("newUsername").value;
      if (!userId) return alert("ID requis");
      try {
        const res = await fetch(`${API_URL}/users/${userId}`, {
          method: "PUT",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ username: newUsername })
        });
        show("updateResult", await res.json());
      } catch (e) {
        show("updateResult", { error: e.message });
      }
    }

    async function importUsers() {
      try {
        const res = await fetch(`${API_URL}/users/import`);
        show("importResult", await res.json());
      } catch (e) {
        show("importResult", { error: e.message });
      }
    }

    async function getGlobalStats() {
      try {
        const res = await fetch(`${API_URL}/users/stats/global`);
        show("globalStatsResult", await res.json());
      } catch (e) {
        show("globalStatsResult", { error: e.message });
      }
    }

    async function exportUsers() {
      try {
        const res = await fetch(`${API_URL}/users/stats/export`);
        show("exportResult", await res.json());
      } catch (e) {
        show("exportResult", { error: e.message });
      }
    }

    async function deleteUser() {
      const userId = document.getElementById("deleteUserId").value;
      if (!userId) return alert("ID requis");
      if (!confirm("Supprimer cet utilisateur ?")) return;
      try {
        const res = await fetch(`${API_URL}/users/${userId}`, { method: "DELETE" });
        show("deleteUserResult", await res.json());
      } catch (e) {
        show("deleteUserResult", { error: e.message });
      }
    }

    // ==================== HABITS ====================
    async function createHabit() {
      const user = document.getElementById("habitUserId").value;
      const title = document.getElementById("habitTitle").value;
      const category = document.getElementById("habitCategory").value;
      const description = document.getElementById("habitDesc").value;
      const frequency = document.getElementById("habitFreq").value;
      try {
        const res = await fetch(`${API_URL}/habits`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ user, title, category, description, frequency }),
        });
        show("habitCreateResult", await res.json());
      } catch (e) {
        show("habitCreateResult", { error: e.message });
      }
    }

    async function filterHabits() {
      const user = document.getElementById("filterUserId").value;
      const category = document.getElementById("filterCategory").value;
      const search = document.getElementById("filterSearch").value;
      const limit = document.getElementById("filterLimit").value;
      const query = new URLSearchParams({ user, category, search, limit });
      try {
        const res = await fetch(`${API_URL}/habits/search?${query}`);
        show("habitFilterResult", await res.json());
      } catch (e) {
        show("habitFilterResult", { error: e.message });
      }
    }

    async function getHabitStats() {
      try {
        const res = await fetch(`${API_URL}/habits/stats/categories`);
        show("habitStatsResult", await res.json());
      } catch (e) {
        show("habitStatsResult", { error: e.message });
      }
    }

    async function getPopularHabits() {
      const limit = document.getElementById("popularLimit").value;
      try {
        const res = await fetch(`${API_URL}/habits/stats/popular?limit=${limit}`);
        show("popularHabitsResult", await res.json());
      } catch (e) {
        show("popularHabitsResult", { error: e.message });
      }
    }

    async function deleteHabit() {
      const habitId = document.getElementById("deleteHabitId").value;
      if (!habitId) return alert("ID requis");
      if (!confirm("Supprimer cette habitude ?")) return;
      try {
        const res = await fetch(`${API_URL}/habits/${habitId}`, { method: "DELETE" });
        show("deleteHabitResult", await res.json());
      } catch (e) {
        show("deleteHabitResult", { error: e.message });
      }
    }

    // ==================== LOGS ====================
    async function createLog() {
      const habit = document.getElementById("logHabitId").value;
      const user = document.getElementById("logUserId").value;
      const completed = document.getElementById("logCompleted").checked;
      const notes = document.getElementById("logNotes").value;
      if (!habit || !user) return alert("Habit ID et User ID requis");
      try {
        const res = await fetch(`${API_URL}/habitlogs`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ habit, user, completed, notes })
        });
        show("createLogResult", await res.json());
      } catch (e) {
        show("createLogResult", { error: e.message });
      }
    }

    async function getHistory() {
      const user = document.getElementById("historyUserId").value;
      const habit = document.getElementById("historyHabitId").value;
      const limit = document.getElementById("historyLimit").value;
      const query = new URLSearchParams({ user, habit, limit });
      try {
        const res = await fetch(`${API_URL}/habitlogs/history?${query}`);
        show("historyResult", await res.json());
      } catch (e) {
        show("historyResult", { error: e.message });
      }
    }

    async function getStreaks() {
      try {
        const res = await fetch(`${API_URL}/habitlogs/streaks`);
        show("streaksResult", await res.json());
      } catch (e) {
        show("streaksResult", { error: e.message });
      }
    }

    async function importLogs() {
      try {
        const res = await fetch(`${API_URL}/habitlogs/import`, { method: "POST" });
        show("importLogsResult", await res.json());
      } catch (e) {
        show("importLogsResult", { error: e.message });
      }
    }

    async function exportLogs() {
      const userId = document.getElementById("exportLogsUserId").value;
      try {
        const res = await fetch(`${API_URL}/habitlogs/export?userId=${userId}`);
        show("exportLogsResult", await res.json());
      } catch (e) {
        show("exportLogsResult", { error: e.message });
      }
    }

    async function deleteLog() {
      const logId = document.getElementById("deleteLogId").value;
      if (!logId) return alert("ID requis");
      if (!confirm("Supprimer ce log ?")) return;
      try {
        const res = await fetch(`${API_URL}/habitlogs/${logId}`, { method: "DELETE" });
        show("deleteLogResult", await res.json());
      } catch (e) {
        show("deleteLogResult", { error: e.message });
      }
    }

    // ==================== STATS ====================
    async function exportStatistics() {
      try {
        const res = await fetch(`${API_URL}/stats/export`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            userId: document.getElementById("stats_export_user").value,
            period: document.getElementById("stats_export_period").value
          })
        });
        show("result_exportStatistics", await res.json());
      } catch (e) {
        show("result_exportStatistics", { error: e.message });
      }
    }

    async function getDashboard() {
      try {
        const params = new URLSearchParams({
          userId: document.getElementById("stats_dashboard_user").value,
          period: document.getElementById("stats_dashboard_period").value
        });
        const res = await fetch(`${API_URL}/stats/dashboard?${params}`);
        show("result_getDashboard", await res.json());
      } catch (e) {
        show("result_getDashboard", { error: e.message });
      }
    }

    async function getUsersWithHabits() {
      try {
        const limit = document.getElementById("stats_aggregation_limit").value;
        const res = await fetch(`${API_URL}/stats/aggregation?limit=${limit}`);
        show("result_getUsersWithHabits", await res.json());
      } catch (e) {
        show("result_getUsersWithHabits", { error: e.message });
      }
    }

    async function getStatsTopHabits() {
      try {
        const limit = document.getElementById("stats_top_limit").value;
        const res = await fetch(`${API_URL}/stats/top-habits?limit=${limit}`);
        show("result_getStatsTopHabits", await res.json());
      } catch (e) {
        show("result_getStatsTopHabits", { error: e.message });
      }
    }

    async function getOverview() {
      try {
        const res = await fetch(`${API_URL}/stats/overview`);
        show("result_getOverview", await res.json());
      } catch (e) {
        show("result_getOverview", { error: e.message });
      }
    }

    async function getStatsByCategory() {
      try {
        const res = await fetch(`${API_URL}/stats/categories`);
        show("result_getStatsByCategory", await res.json());
      } catch (e) {
        show("result_getStatsByCategory", { error: e.message });
      }
    }

    async function importStats() {
      try {
        const res = await fetch(`${API_URL}/stats/import`, { method: "POST" });
        show("result_importStats", await res.json());
      } catch (e) {
        show("result_importStats", { error: e.message });
      }
    }
  </script>
</body>
</html>